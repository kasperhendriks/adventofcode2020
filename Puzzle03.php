<?php declare(strict_types=1);

namespace AdventOfCode2020;

echo sprintf('Puzzle 3 part 1: %d'.PHP_EOL, (new Puzzle03())->part1());
echo sprintf('Puzzle 3 part 2: %d'.PHP_EOL, (new Puzzle03())->part2());

final class Puzzle03
{
    public function part1(): int
    {
        $trees = 0;
        $x = 0;

        $lines = $this->getInput();

        $repeat = 3 * count($lines);

        foreach ($lines as $line) {
            $line = str_repeat($line, $repeat);

            if ('#' === $line[$x]) {
                $trees++;
            }

            $x += 3;
        }

        return $trees;
    }

    public function part2(): int
    {
        $total = 1;

        $total *= $this->calculate(1, 1);
        $total *= $this->calculate(3, 1);
        $total *= $this->calculate(5, 1);
        $total *= $this->calculate(7, 1);
        $total *= $this->calculate(1, 2);

        return $total;
    }

    private function calculate(int $right, int $down): int
    {
        $trees = 0;
        $x = 0;

        $lines = $this->getInput();

        $repeat = $right * count($lines);

        foreach ($lines as $i => $line) {
            if ($i % $down) {
                continue;
            }

            $line = str_repeat($line, $repeat);

            if ('#' === $line[$x]) {
                $trees++;
            }

            $x += $right;
        }

        return $trees;
    }

    private function getInput(bool $test = false): array
    {
        if ($test) {
            return [
                '..##.......',
                '#...#...#..',
                '.#....#..#.',
                '..#.#...#.#',
                '.#...##..#.',
                '..#.##.....',
                '.#.#.#....#',
                '.#........#',
                '#.##...#...',
                '#...##....#',
                '.#..#...#.#',
            ];
        }

        return [
            '...#..............#.#....#..#..',
            '...#..#..#..............#..#...',
            '....#.#.......#............#...',
            '..##.....##.........#........##',
            '...#...........#...##.#...#.##.',
            '..#.#...#....#.....#........#..',
            '....##.###.....#..#.......#....',
            '.#..##...#.....#......#..#.....',
            '............##.#...#.#.....#.#.',
            '..........#....#....#.#...#...#',
            '..##....#.#.#......#.........#.',
            '#.#.........#..............##..',
            '....##.##......................',
            '....##..#...........#..........',
            '..#..#.#........##....#......#.',
            '..............#..#....#.....#..',
            '.............#...#.....#...#...',
            '.#...........#..........#...#..',
            '.#......#.......#......#.......',
            '#..#.............#..#....##.###',
            '........#.#...........##.#...#.',
            '......#..#.....##......#.......',
            '.....#.....#....#..............',
            '#...##.#......#......#...#.....',
            '...........................#...',
            '...#....................#.....#',
            '..#.....#...#.....##.....#.....',
            '....................#......#..#',
            '.......#.....##......##....#...',
            '#........##...#.....##..#...#..',
            '........#..#.#......#..###..#.#',
            '##.....#.............#.#....#..',
            '..#.................#....######',
            '.#.#..#.....#.#..........#.#...',
            '.........#....#...#............',
            '........#..#.....#.............',
            '............#.#.............##.',
            '...#....#..#......#............',
            '.##....#.....#...#.#...........',
            '..#..............#...........##',
            '.....#.#.##...#................',
            '..........#..#.#..........##..#',
            '..#....#...#...#.....######....',
            '....#.#..#........#....#.###...',
            '.......................#.......',
            '..#.....#.##................#..',
            '.....#......#..#.....#........#',
            '.#...###.......#.#.........#..#',
            '............#..................',
            '..#.........##.........##......',
            '#...........#.#.......###.#....',
            '.#...#.....#.........###.....#.',
            '.#............#........#..#....',
            '...##.#......##................',
            '........#...#...#...#..........',
            '.......#.##......##.#..........',
            '....##.......#..#....#....#....',
            '......#.........###........#...',
            '#....#....####....##......#....',
            '......................#....#.#.',
            '...#.#.#....#.#...#...#......#.',
            '......#.....##.#...........###.',
            '#........#.........##......#.#.',
            '....##.....#.....#..#..........',
            '......#...#...#.........#...##.',
            '..#........#..................#',
            '.........#..##.#..#..#...#.#..#',
            '.....#.....#...#.....###.....##',
            '.............#....#...#........',
            '..........#.#.#...#..#...#....#',
            '#...............##.......#.....',
            '#...#.............#..#...#....#',
            '..#...#...##...##...#..#.......',
            '..#..#........#.#...........#..',
            '.....#.....#..................#',
            '....#....##....###..###...##...',
            '..#......###.........##....#.##',
            '.......#.##...#.......#..#.....',
            '...#.#.#.#.....##..#..#........',
            '................##....#.#......',
            '..#...#...#...#.....##.#...#..#',
            '..#..#.....#..##....#....#.....',
            '.###...#......#........#.....##',
            '##......#..#........#..........',
            '....#...#..#....##..#......####',
            '.#.....##....#..........#......',
            '.#...#....#.........#...#....#.',
            '.....#..#.#..#......#..##....#.',
            '...#.##...#...#........#......#',
            '.#..#...#.#..#.........#...#...',
            '#....#......##.....#.......#...',
            '..##............##..#.#.#...#..',
            '##.......#.......##............',
            '#......#.##........#...#...#...',
            '.#.#.......##.........#..#.#...',
            '.............##.#........#.....',
            '.#..#...###...#..#.............',
            '.....#...#..#....#.......#.....',
            '#.#.........#.#.#...#...#.#....',
            '.....#.......#.##.##...#....#..',
            '.#.##..#.....#...#.#.#.#.#..#..',
            '..........#...................#',
            '.....#.#.#...##.........#..#..#',
            '.#..#....##......#...#.........',
            '.##......#......#...#........#.',
            '.....##.#......#............#.#',
            '.#.....##..#...........##......',
            '.....#......#.......##....#....',
            '..#..##..........#.#..........#',
            '#.#.......##..#..##.#....#.....',
            '.......#..#.#.......##......#.#',
            '....#...##...#..............#..',
            '.....#.........#......#...##...',
            '#.........#........##..#.....#.',
            '.#.#..#.....##.......#......#..',
            '........#..#....#.....###..#...',
            '#.#..#.#..........#............',
            '..#......##..#....#.........#..',
            '#..............................',
            '.......#............#..#..#.#..',
            '.#.....#.#....#..#.##.#........',
            '.......#.###.#........##.#..#..',
            '..............#....#.....##.#..',
            '#..............#....#.###......',
            '.#..#..#...###............#...#',
            '.#.##...#....#..#...#...#......',
            '......##..#..#......#..#....#..',
            '.........#.......##............',
            '...........##...#..#....####...',
            '.#..................#..........',
            '#...#..#..................#....',
            '..............#.....##.....#...',
            '..#.#..#...##..#.....#.....#..#',
            '....#....#.#.........#.....#...',
            '.#.......#...#....#...#.#..#..#',
            '#.........##.....##.......#...#',
            '#..#............#....#........#',
            '..........##...#......#....#...',
            '.......#..##...............#...',
            '#............#.#.#.....#.......',
            '.#........##...#...............',
            '..##....#.....#..#.##.#......#.',
            '.#...#.............#...#.....#.',
            '...##....#.......#......#.#..#.',
            '#......................#..#.##.',
            '...#..........#..#.........#...',
            '..#......#.......#.#....#......',
            '....#............#...#......#..',
            '.....#..#..##...#...#.........#',
            '.....#......#....#....#........',
            '.............#..#..........#...',
            '....#..............#.....#.#...',
            '....#.................#.#...#.#',
            '.........#.#...........###.#.##',
            '#...........#..##.#....#.##.#..',
            '#.#.....#......................',
            '##.#.........#....##.#.#..#.#..',
            '#..........#.#.#.#.#..#..##..#.',
            '..#...#..###.........#......#..',
            '.....#......#..#.#............#',
            '...........#...#.#.#.###....#..',
            '#....#..#.......##.#.......##..',
            '..............#.....##.#.......',
            '.#.....#.#..#.........#.#.#..#.',
            '..#..#..#..#................#..',
            '...........#..#.#...#.........#',
            '.#..#..#...#........#...#.#..#.',
            '...#.#..#......#..#............',
            '........#......##.....#....#...',
            '#...#......##.#.#..............',
            '.#........................#....',
            '#.#.....#.##.....#..#.#........',
            '#..........##.#.......#....#..#',
            '#...#..#..#.....#....#....#....',
            '#...........#..#.#....##.##....',
            '##......#..#........#.......##.',
            '#........#..#...#..........#...',
            '...#...#......##....#.#........',
            '...##..#..#.##....#...#........',
            '#.#..#....#...#........#.......',
            '..........#.......#..........#.',
            '......##...#....###...#....#...',
            '........#..#.....#......#......',
            '....#.........##...#..##......#',
            '....#...........#.#..#.#.#.#..#',
            '..#......#..#......#........#.#',
            '#..#....#.....#.............#..',
            '............................#..',
            '#...#.#.....#...#....#....#....',
            '........#...#...#...#...#......',
            '.###........#....#.##.....##.#.',
            '.........#.....#..........#....',
            '.#.........#....##.#.....#.....',
            '#..#....................##.#...',
            '..##.#.............#....#.#....',
            '..#.#........#............##.#.',
            '#........#...##.....#...#.....#',
            '.........#.#..........#....#..#',
            '...###.#..#.#......#.#.....#...',
            '......#.....#..#...#........#..',
            '.......#...#.....#....#....#..#',
            '.#.#........#......##.......#..',
            '#.................###..........',
            '#........#.#..#....#..#........',
            '..##....#.#...##...#...##....#.',
            '...#.#......##...#.....#..#....',
            '#..#........#...###....#.......',
            '##.#....#..#.#..........#......',
            '....#...###...#.....#........#.',
            '..#.#........#....##.#.........',
            '......##.##.................##.',
            '.#....##...#.#..#.#............',
            '.#...###........#......#.......',
            '##..#.#......#..#..#...#.......',
            '.......##..#....#........#....#',
            '......#..........#.............',
            '....##..##..#......#.#.........',
            '.....#....................##...',
            '...###.....#.....#...#.#.##.#..',
            '....#.#..#.......#..#......##..',
            '.......#.#..#.##.#...#......#..',
            '...#.#....#.#...#..##...#...#..',
            '#.##...#....#..#.............#.',
            '...#...#...#.......#..........#',
            '.#..#.............#..##.#......',
            '....#.......#..............#.#.',
            '..................#..#.....##.#',
            '.#...#..#......#..........#...#',
            '..#.#.....#..#....#....#####.#.',
            '.......###.......#....#....#...',
            '......#.#........#...#.........',
            '......#..#.#.#....#.#.#....##..',
            '.#...#.#...##.#......#.........',
            '#....#..##....#.#.......#....#.',
            '..##.#.....#.....#.........#...',
            '......#......#....#....#.....#.',
            '...##.....#....#......#......#.',
            '......#......##............#.#.',
            '.##.#.......#....#...#....#....',
            '....#..#..#...##.......#..#....',
            '....#....#...#.#........#..#...',
            '....#.....#..........#..#......',
            '....#....#...#.....#..##.....#.',
            '##...#..##......#....##..#..#..',
            '.....##.##..............##.....',
            '#.#....#.##..#....#...##.......',
            '..#.....##.....#.....######...#',
            '...#.....#.#.#......#......##.#',
            '...........##.............#....',
            '...##......#..#......#...#.....',
            '....#.##......#..#....#.#..#...',
            '.#..#....#...#..#.....##.......',
            '.....#..#.................#..#.',
            '................#..#...#......#',
            '...##....#.....#..#....##......',
            '....##...............##...#....',
            '......#..........#..##.........',
            '.......###.......#.........#..#',
            '......................#....#.#.',
            '#.#.....#...##............#....',
            '........#......##......#.....#.',
            '...#....#....#.#..##.#..#.#.#..',
            '..#.#....#.##...#..#.....#.#...',
            '............#....#..#.......#..',
            '#...#...#.#......#...##.....#.#',
            '......#....#....#.......#......',
            '....#.......#..........#....#..',
            '........#####........#....#....',
            '......#....##..............#.#.',
            '....#....#.......#.......#.....',
            '.##.#....##....#...............',
            '#.....##........#..#.#...#.#...',
            '...#......##....#..............',
            '.#.....#.....#.......##....##..',
            '#....#..........#.#..#.........',
            '......##..........##.......#...',
            '.##......##.....#.#....#......#',
            '....#......................#...',
            '.#...........###........#...#..',
            '#.#..#..#..#...##.#....#.#..#..',
            '...##...........#.#..........#.',
            '......#.#..#....#....#.........',
            '....#....#.#......#.........##.',
            '.#..#...#...##....#...#......#.',
            '#.#......#...#.#.#...........#.',
            '##.....#..........##....##..##.',
            '...#.#.....#..##........#......',
            '..#........##........#..#......',
            '.......#...............##..#...',
            '.......#.#....#..###...........',
            '.............#........#...#....',
            '#.................#......#..#..',
            '...#....#..#..............#...#',
            '.............#....##....#..##..',
            '#........#..........##...##...#',
            '............#....#.....#.#....#',
            '.....#..............##..#...#..',
            '..#....#......###....#.#...##..',
            '....##......#.....#....#.......',
            '.....#...............#.....#...',
            '.#.....#.....#..............#..',
            '#................#..#..........',
            '.##....#....#.....#............',
            '#.####...#..#..#....#..........',
            '..##........##.....##......#..#',
            '......#.....#...##.........##..',
            '....##..#.....#.#.........#...#',
            '.....##..#....#....#.#...#..#..',
            '...#............#...........#..',
            '.......#.#..#.#.#..#........#.#',
            '....#.#........#.#.#..#...#...#',
            '..#....#....#..#......#........',
            '.#...........................#.',
            '.#..#....####........##......#.',
            '.#.....#..#.#.................#',
            '.#..#...........#...#....#...#.',
            '......##..#........#..#....#...',
            '..#.............#....#........#',
            '#.#..........#.##.......#.#..#.',
            '..#....#...#...............#...',
            '..............#..........#..#..',
            '..#.....#.#.....#...#...#..#...',
            '.........#...###.#...#........#',
        ];
    }
}
